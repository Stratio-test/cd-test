= Guía de operaciones

== Descripción

El conector SSCC SAS® Grid Manager te permite la integración de ficheros generados por SAS® Grid Manager en _Stratio Generative AI Data Fabric_. En la versión actual, estos ficheros deben ser accesibles a través del protocolo SFTP.

Las funcionalidades y versiones soportadas se encuentran en la xref:sas-grid-manager:compatibility-matrix.adoc[matriz de compatibilidad].

=== Autenticación

Actualmente, el conector soporta el modo de autenticación con *usuario y contraseña* a través del protocolo SFTP.

Como se verá más adelante, habrá que usar unos valores de configuración y credenciales específicas de _Stratio Generative AI Data Fabric_.

== Prerrequisitos

. Instalar el xref:connectors-repository:operations-guide.adoc#_instalación[repositorio de conectores].
+
Visita la sección de la xref:connectors-repository:operations-guide.adoc#_instalación[Guía de operaciones] para averiguar cómo instalar el repositorio.
+
IMPORTANT: En el repositorio de conectores se tendrá disponible en la URL `http://connectors.<tenant>-<namespace>/v1/api/artifact/<nombre_artefacto>` el artefacto `sscc-sas-0.3_2.12-1.1.x`, que se utiliza para un uso básico del conector SSCC SAS® Grid Manager.

. Tener accesible la interfaz de usuario de _Stratio KMS_ para la gestión de credenciales:
+
Visita la sección de la xref:ROOT:quick-start-guide.adoc#access-kms-ui[interfaz de usuario de _Stratio KMS_] para consultar los pasos necesarios para tenerla disponible.

. Tener los ficheros accesibles para _Stratio Generative AI Data Fabric_ a través del protocolo SFTP con el modo de autenticación configurado:
+
** Para la autenticación básica hará falta un usuario por servicio con los permisos adecuados y su contraseña.
** Deberás disponer de un usuario de tipo servidor _file system_ para cada servicio de _Stratio Generative AI Data Fabric_. Cada usuario deberá tener los siguientes permisos mínimos del servicio de la plataforma.
+
|===
| Servicio | Tablas | Directorios

| _Stratio Data Governance_
| -r--r----- (440)
| dr--r----- (440)

| _Stratio Virtualizer_
| -r--r----- (440)
| dr--r----- (440)

| _Stratio Rocket_
| -r--r----- (440)
| dr--r----- (440)

| _Workflows_ de _Stratio Rocket_
| -r--r----- (440)
| dr--r----- (440)

| _Stratio Intelligence_
| -r--r----- (440)
| dr--r----- (440)
|===

. Crear los secretos en _Stratio KMS_. Para ello debes acceder a `https://<stratio_kms_ui_url>/ui/vault/secrets` y crear un secreto diferente en la carpeta correspondiente del servicio con las siguientes opciones:
+
** Usuario/contraseña
*** *_user_*: `<sas_user>`.
*** *_pass_*: `<sas_password>`.
+
Cada secreto debe subirse a cada uno de los directorios de _Stratio KMS_, como se muestra a continuación:

** *Agente de descubrimiento*: `userland/passwords/<nombre_agente>.<namespace>/<nombre_secreto_discovery>`.
** *_Stratio Virtualizer_*: `userland/passwords/<nombre_virtualizer>.<namespace_virtualizer>/<nombre_secreto_virtualizer>`.
** *_Stratio Rocket_*: `userland/passwords/<nombre_rocket>.<namespace_rocket>/<nombre_secreto_rocket>`.
** *_Workflows_ de _Stratio Rocket_*: `userland/passwords/<nombre_secreto_workflow_rocket>`.
** *_Stratio Intelligence_*: `/people/passwords/<nombre_usuario_intelligence>/<nombre_secreto>`.
+
NOTE: El nombre del secreto para todos los servicios debe coincidir con los elegidos para configurar el agente de descubrimiento.
+
--
NOTE: Es necesario reiniciar el servicio tras modificar esta configuración para que tenga efecto.
--

== Descubre tus datos

=== Agente de descubrimiento

Para instalar un agente de descubrimiento de _Stratio Data Governance_ para SAS® Grid Manager debes seleccionar en '_Stratio Command Center_' -> 'Deploy a Service' -> 'Connectors FS' el agente "SAS® Grid Manager Agent".

Los campos a rellenar para la instalación son:

* *_General_*
** *_Service ID_*: identificador único del agente. Ejemplo: _dg-sasgrid-agent_.
** *_Service name_*: nombre mostrado en _Stratio KEOS_. Ejemplo: _dg-sasgrid-agent_.
* *Metadata Datastore (PostgreSQL®)*
** *_Host_*: instancia de PostgreSQL® que almacena los metadatos descubiertos. Ejemplo: _pgbouncer-postgreskeos-governance.keos-core_.
* *Configuration of the Service to be Discovered*
** *Service to be discovered:*
*** *_Service name_*: nombre que se utilizará para identificar este almacén de datos en _Stratio Data Governance_. Es el que se mostrará en su interfaz de usuario. Ejemplo: _dg-sasgrid-agent_.
*** *_Root discovery path_*: identificador del recurso SAS® Grid Manager que quieras que sea descubierto. Deben estar separados por comas, sin espacios, y con una `/` al principio. Ejemplo: `/sas/connectorstest,/usr/local/SASHome/SASFoundation/9.4/sashelp`.
+
image::sas-grid-cct-deployment1.png[]
+
** *Resource datastore connection configuration*
*** *_Custom Service URL_*: URL JDBC usada para conectarse al servidor del sistema de ficheros. Ejemplo: `gridconnectors.stratio.com:22`.
*** *_Custom data store service security_*: tipo de autenticación utilizada para la conexión: MD5 (usuario/contraseña).
*** *_Access credentials_*: nombre del secreto creado en xref:#create-secret[_Stratio KMS_]. Ejemplo: _sasgrid-secret_.
*** *_SSCC driver location_*: URL donde se encuentra el artefacto en el repositorio de conectores que contendrá el JAR del conector SSCC SAS® Grid Manager. Ejemplo: `http://connectors.<tenant>-<namespace>/v1/api/artifact/sscc-sas-0.3_2.12-1.1.x.jar`.
** *DFS configuration parameters*
*** *_GLOB filter_*: https://en.wikipedia.org/wiki/Glob_(programming)[patrón GLOB] para filtrar directorios. Pueden incluirse varios patrones separados por `;`.
*** *_Parallelism Level_*: grado de paralelismo usado en el descubrimiento. Por defecto, se calcula automáticamente en función de la capacidad de CPU asignada al agente.
+
image::sas-grid-cct-deployment2.png[]

El proceso de descubrimiento es asíncrono, una vez terminado el descubrimiento se podrá visualizar desde la interfaz de usuario de _Stratio Data Governance_.

image::sas-grid-discover-metadata.png[]

== Virtualiza tus datos

IMPORTANT: Ten en cuenta que para virtualizar las tablas descubiertas es necesario gestionar las xref:stratio-gosec:operations-manual:data-access/manage-policies/manage-domains-policies.adoc[políticas de dominios] a través de _Stratio GoSec_.

=== Agente de Eureka

Para el uso de la BDL es necesario configurar el agente de Eureka con el conector SSCC SAS® Grid Manager. Para ello basta con añadir la URL del repositorio de conectores del artefacto `sscc-sas-0.3_2.12-1.1.x` en la variable 'Customized deployment' -> 'Settings' -> `Additional jars`.

image::sas-viya-bdl.png[]

NOTE: Recuerda que, si ya tienes más de un artefacto en la lista, se deben añadir los siguientes separándolos por una coma.

TIP: Consulta aquí xref:stratio-data-governance:user-manual:data-processing-with-bdl.adoc[más información acerca del procesamiento de datos con BDL].

=== _Stratio Virtualizer_

_Stratio Virtualizer_ soporta la interacción con SAS® Grid Manager a través del conector SSCC SAS® Grid Manager. Esta integración tiene ciertos requisitos:

* Se deben modificar los siguientes campos del despliegue de _Stratio Virtualizer_ en _Stratio Command Center_.
+
--
** 'Customized deployment' -> 'Environment' -> 'External datastores' -> 'JDBC Integration'.
*** *_JDBC Integration_*: `True`.
** 'Customized deployment' -> 'Environment' -> 'External datastores' -> 'JDBC Drivers URL List'.
*** *_JDBC Drivers URL List_*: `http://connectors.<tenant>-<namespace>/v1/api/artifact/sscc-sas-0.3_2.12-1.1.x.jar`.
--
+
image::sas-viya-virtualizer-conf.png[]

== Transforma tus datos

=== _Stratio Rocket_

Para el uso de _Stratio Rocket_ es necesario tener el conector SSCC SAS® Grid Manager configurado. Para ello:

* Se debe añadir la URL del artefacto `sscc-sas-0.3_2.12-1.1.x` en la variable 'Customized deployment' -> 'Settings' -> 'Classpath configuration' -> `Rocket extra jars` de _Stratio Command Center_.
** *_Rocket extra jars_*: `http://connectors.<tenant>-<namespace>/v1/api/artifact/sscc-sas-0.3_2.12-1.1.x.jar`.
+
image::sas-viya-rocket-conf.png[]

* Introduce la siguiente variable en la configuración de _Stratio Rocket_: `SPARK_HADOOP_FS_SFTP_IMPL`*: `com.stratio.connectors.sftp.fs.SSCCSFTPFileSystem`.
* Además, debes subir las credenciales de acceso para los _workflows_ y para _Stratio Rocket_ a _Stratio KMS_.

=== _Stratio Intelligence_

Previo a la integración con el conector es necesario configurar _Stratio Intelligence_, tal y como aparece descrito en xref:ROOT:quick-start-guide#_stratio_intelligence[la guía de inicio rápido general].

==== Gestión del _driver_

Para acceder y explotar los datos de SAS® Grid Manager es necesario configurar _Stratio Intelligence_ de la siguiente manera:

* Añadir el conector SSCC SAS® Grid Manager a la instancia de _Stratio Intelligence_:
** Navega hasta '_Stratio Command Center_' -> 'Services' -> '<Tu Namespace>' -> 'intelligence' -> 'Edit' -> 'Customize deployment' -> 'Settings' -> 'Analytic Environment Settings' -> 'Extra jars to Spark Context Configuration'.
** Añade al campo _Spark classpath extra jars_ la URL del conector `http://connectors.<tenant>-<namespace>/v1/api/artifact/sscc-sas-0.3_2.12-1.1.x.jar`.
+
image::sas-grid:conf-intelligence.png[]
+
** Añade esa misma URL al _classpath_ de Apache Spark™.
+
IMPORTANT: Debido a que _Stratio Intelligence_ necesita disponer del conector en tiempo de inicialización de Apache Spark™, es necesario que el conector se encuentre en el _classpath_ al arrancar el _Notebook_. Actualmente, la manera de hacerlo es editando el descriptor correspondiente a _Stratio Intelligence_ en Kubernetes y añadir la URL del conector a la variable de entorno `ANALYTIC_ENV_SPARK_HOME_EXTRA_JARS`.
+
image::sas-grid:conf-intelligence-env-vars.png[]

==== Gestión de los secretos

Sube las credenciales de acceso para los _workflows_ y para _Stratio Intelligence_ a _Stratio KMS_ tal como aparece descrito en los prerrequisitos.
