= Guía de usuario

== Descripción

El conector SSCC Snowflake te permite la integración completa de Snowflake en _Stratio Generative AI Data Fabric_.

Las funcionalidades y versiones soportadas se encuentran en la xref:snowflake:compatibility-matrix.adoc[matriz de compatibilidad].

== Descubre tus datos

=== Conoce tus datos

Además de lo que se muestra en xref:stratio-data-governance:user-manual:from-a-data-store-to-a-dictionary.adoc#_tablas_y_columnas[_Stratio Data Governance_], también puedes encontrar los atributos técnicos extraídos de los recursos de Snowflake. Se extraen todos los metadatos que proporciona Snowflake y se añaden a la interfaz de usuario de _Stratio Data Governance_ tanto en tabla como en columna.

* Los metadatos extraídos a nivel de agente de descubrimiento son _databaseName_, _databaseVersion_, _jdbcDriver_, _jdbcDriverName_, _jdbcDriverVersion_, _proxyAddress_, _proxyAuthEnabled_, _proxyEnabled_ y _warehouse_.
* Los metadatos extraídos a nivel de tabla son _tableType_, _table_, _schema_, _database_ y _description_ de la tabla.
+
image:snowflake-table-metadata.png[]
+
* Los metadatos extraídos a nivel de columna son _type_, _nullable_, _ordinal_, _typedId_ y _properties_, entre las que se encuentra _description_.
+
image:snowflake-column-metadata1.png[]

=== Virtualización de la BDL

El proceso de descubrimiento es asíncrono. Una vez terminado, se podrá visualizar desde la interfaz de usuario de _Stratio Data Governance_.

El conector soporta la personalización del acceso al dato en las tablas virtualizadas mediante xref:stratio-data-governance:user-manual:bdl-virtualization.adoc#_atributos_personalizados_de_bdl[atributos avanzados de BDL] de _Stratio Data Governance_, modificables desde la interfaz de usuario.

*Atributos personalizados de _Stratio Data Governance_*:

* *bdl.options.snowflake.warehouse*: nombre del _warehouse_ sobre el que se realizarán las operaciones de virtualización en cada tabla elegida, siendo el _warehouse_ elegido diferente al que hay por defecto de cada usuario.
* *bdl.options.virtualizer.native*: los posibles valores son "True" y "False". "True" si el usuario quiere acceder al dato con el xref:stratio-virtualizer:user-guide:what-can-i-do-with-stratio-virtualizer.adoc#_consultas_nativas[dialecto nativo] de _Stratio Virtualizer_. Si se configura este atributo, se sobrescribirá la configuración por defecto ("True").
* *bdl.options.native.filter*: filtro genérico aplicado dentro de una cláusula SQL `where` en caso de que el modo de acceso al dato sea con el dialecto nativo de _Stratio Virtualizer_.
* *bdl.options.time.travel*: fecha aplicada sobre una cláusula SQL `time travel` en caso de que el modo de acceso al dato sea con el dialecto nativo de _Stratio Virtualizer_. Ejemplo: `Fri, 01 May 2015 16:20:00 -0700`.

NOTE: En el atributo `time.travel` únicamente podrás seleccionar un instante exacto en el tiempo del estado en que se encontraba la tabla. Puedes poner una fecha en formato _Datetime_.

El usuario configurado para cada módulo deberá tener un _warehouse_ configurado por defecto. Si deseas configurar uno específico para una tabla concreta (proceso de lectura/escritura), añade la etiqueta anterior a la tabla en el catálogo.

NOTE: Puedes consultar cómo crear atributos en la xref:stratio-data-governance:user-manual:addition-of-metadata[guía de usuario] de _Stratio Data Governance_.

TIP: Para más detalles del uso de la BDL consulta la xref:stratio-data-governance:user-manual:data-processing-with-bdl.adoc[documentación de procesamiento de datos con BDL].

== Virtualiza tus datos

Una vez descubiertas las tablas, es posible añadirlas a una vista técnica de una colección. Todos los parámetros configurables del descubrimiento y los modificados desde la interfaz de usuario de _Stratio Data Governance_ se propagan en las colecciones donde se añada esa tabla.

TIP: Para saber más sobre cómo gestionar las colecciones puedes consultar xref:stratio-data-governance:user-manual:collections.adoc[la guía de usuario de _Stratio Data Governance_].

IMPORTANT: Ten en cuenta que, para virtualizar las tablas descubiertas, es necesario gestionar las xref:stratio-gosec:operations-manual:data-access/manage-policies/manage-domains-policies.adoc[políticas de dominios] a través de _Stratio GoSec_.

Para crear una tabla directamente en el catálogo de _Stratio Virtualizer_ puedes ejecutar las siguientes sentencias:

* Si quieres crear la tabla con el modo nativo:

[source,sql]
----
CREATE TABLE snowflake_table USING com.stratio.crossdata.connector.snowflake OPTIONS (
    `stratiocredentials` '<nombre_secreto>',
    `stratiosecurity` 'true',
    `url` 'jdbc:snowflake://asd1234.us-east-1.snowflakecomputing.com/?db=SNOWFLAKE_DB',
    `stratiossccdriver` 'com.stratio.connectors.ssccsnowflake.SnowflakeDriverMD5',
    `driver` 'net.snowflake.client.jdbc.SnowflakeDriver',
    `dbtable` '<nombre_tabla>',
    `stratiosecuritymode` 'custom_sscc',
)
----

* Si quieres crear la tabla sin el modo nativo:

[source,sql]
----
CREATE TABLE snowflake_table USING jdbc OPTIONS (
    `stratiocredentials` '<nombre_secreto>',
    `stratiosecurity` 'true',
    `url` 'jdbc:snowflake://asd1234.us-east-1.snowflakecomputing.com/?db=SNOWFLAKE_DB',
    `stratiossccdriver` 'com.stratio.connectors.ssccsnowflake.SnowflakeDriverMD5',
    `driver` 'net.snowflake.client.jdbc.SnowflakeDriver',
    `dbtable` '<nombre_tabla>',
    `stratiosecuritymode` 'custom_sscc',
)
----

Para usar autenticación _Key pair_ en lugar de usuario y contraseña, reemplaza `com.stratio.connectors.ssccsnowflake.SnowflakeDriverMD5` por `com.stratio.connectors.ssccsnowflake.SnowflakeDriverKeyPair`.

Si deseas realizar una conexión hacia un _warehouse_ y siguiendo el ejemplo de arriba, añade al parámetro `url` el _warehouse_ de la siguiente manera:
`jdbc:snowflake://asd1234.us-east-1.snowflakecomputing.com/?db=SNOWFLAKE_DB&warehouse=<tu_warehouse>``.

Si deseas realizar una conexión hacia un proxy (sin autenticación), añade al parámetro `url` la siguiente configuración:
`jdbc:snowflake://asd1234.us-east-1.snowflakecomputing.com/?db=SNOWFLAKE_DB&useProxy=true&proxyHost=<tu_host>&proxyPort=<tu_port>`.

Si deseas realizar una conexión hacia un proxy (con autenticación), añade al parámetro `url` la siguiente configuración:
`jdbc:snowflake://asd1234.us-east-1.snowflakecomputing.com/?db=SNOWFLAKE_DB&useProxy=true&proxyHost=<tu_host>&proxyPort=<tu_port>&proxyUser=<proxy_user>&proxyPassword=<proxyPassword>`.

NOTE: Para la configuración del ejemplo anterior se puede intercambiar el uso de _warehouse_ y proxy.

== Transforma tus datos

=== _Stratio Rocket_

Una vez virtualizados los datos, es posible acceder desde _Stratio Rocket_ mediante:

* El catálogo.
+
image:snowflake-rocket-catalog.png[]

* Dentro de los _workflows_, haciendo uso del _input_ de xref:stratio-rocket:user-guide:workflow-asset/data-inputs.adoc#_stratio_virtualizer[_Stratio Virtualizer_]. Es posible forzar el acceso mediante el dialecto nativo marcando la casilla "Force query execution with native connectors".
+
image:snowflake-rocket-virtualizer-input.png[]

=== _Stratio Intelligence_

Se puede comprobar cómo se accede a los datos desde _Stratio Intelligence_ en la xref:ROOT:quick-start-guide.adoc#_stratio_intelligence[guía de inicio rápido general].
