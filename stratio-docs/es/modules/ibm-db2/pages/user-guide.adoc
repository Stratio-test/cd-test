= Guía de usuario

== Descripción

El conector SSCC IBM Db2 te permite la integración completa de IBM Db2 en _Stratio Generative AI Data Fabric_.

Las funcionalidades y versiones soportadas se encuentran en la xref:ibm-db2:compatibility-matrix.adoc[matriz de compatibilidad].

== Descubre tus datos

=== Conoce tus datos

_Stratio Generative AI Data Fabric_ puede realizar tareas de descubrimiento de los metadatos de IBM Db2. La jerarquía soportada por el conector es:

. Bases de datos
. Esquemas
. Tablas
. Columnas

Para descubrir correctamente los datos, la base de datos IBM Db2 debe estar organizada conforme a la estructura anterior. También tienes que proporcionar al agente de descubrimiento el nombre de las bases de datos a las que quieres que se conecte.

TIP: Consulta la https://www.ibm.com/docs/en/db2/11.5?topic=database-administration[Guía oficial IBM Db2] para más información.

El único tipo de autenticación soportada es *usuario/contraseña (MD5)*.

Algunos de los atributos del agente de descubrimiento son los siguientes:

* _Security_: *MD5*. Autenticación usuario/contraseña. Es único.
* _driver_: *com.stratio.connectors.ssccdb2.Db2DriverMD5*.
* _databaseName_: nombre de tu base de datos que ha descubierto.
* _databaseVersion_: versión de tu base de datos que ha descubierto.
* _jdbcDriver_: URL del _driver JDBC_.
* _jdbcDriverName_: nombre del _driver JDBC_.
* _jdbcDriverVersion_: versión del _driver JDBC_.

Estas son las vistas en el descubrimiento:

*Base de datos*

image::db2-vista-total-db.png[]

Atributos:

* type: db2

*Esquema + tabla*

image::db2-vista-total-tablas.png[]

Atributos:

* _Primary keys_
* _Foreign keys_
* _Unique keys_
* _database_: nombre de la base de datos.
* _schema_: nombre del esquema.
* _table_: nombre de la tabla.
* _table type_: puede ser "TABLE" o "VIEW".

*Columnas*

image::db2-vista-cols-total.png[]

Atributos:

* _type_: tipo de conversión del dato a la plataforma _Stratio Generative AI Data Fabric_.
* _nullable_: si el campo admite nulos.
* _ordinal_: el número de columna.
* _precision + scale_: el tamaño del campo.
* _isSigned_: si está verificado.
* _sourceType_: el tipo del campo original en la base de datos IBM Db2.

Ahora puedes crear tus colecciones técnicas.

IMPORTANT: Si quieres añadir atributos a las tablas debes hacerlo sobre la tabla añadida a la colección técnica, nunca sobre el propio agente de descubrimiento.

La conversión de datos utilizada por _Stratio Generative AI Data Fabric_ para IBM Db2 es la siguiente:

|===
|Tipo IBM Db2 |Tipo Stratio |Tipo IBM Db2 |Tipo Stratio |Tipo IBM Db2 |Tipo Stratio

|XML
|STRING
|VARCHAR
|STRING
|CHAR
|STRING

|VARGRAPHIC
|STRING
|GRAPHIC
|STRING
|TIME
|TIMESTAMP

|TIMESTAMP
|TIMESTAMP
|INT
|INTEGER
|INTEGER
|INTEGER

|SMALLINT
|INTEGER
|DECIMAL
|DECIMAL
|NUMERIC
|DECIMAL

|DECFLOAT
|DECIMAL(38,18)
|DOUBLE
|DOUBLE
|BLOB
|BINARY

|CLOB
|STRING
|REAL
|FLOAT
|BOOLEAN
|BOOLEAN

|BINARY
|BINARY
|UNKNOWN
|STRING
|LABEL
|STRING
|===

== Virtualiza tus datos

Una vez descubiertas las tablas, es posible añadirlas a una vista técnica de una colección. Todos los parámetros configurables del descubrimiento y los modificados desde la interfaz de usuario de _Stratio Data Governance_ se propagan en las colecciones donde se añada esa tabla.

TIP: Puedes leer más acerca de sus características en su xref:stratio-data-governance:user-manual:collections.adoc[guía de usuario].

IMPORTANT: Ten en cuenta que, para virtualizar las tablas descubiertas, es necesario gestionar las xref:stratio-gosec:operations-manual:data-access/manage-policies/manage-domains-policies.adoc[políticas de dominios] a través de _Stratio GoSec_.

Si quieres conocer más sobre los modos de virtualización, visita la xref:stratio-virtualizer:user-guide:what-can-i-do-with-stratio-virtualizer.adoc#_fuentes_de_datos_soportadas[guía de _Stratio Virtualizer_].

Para configurar _Stratio Virtualizer_ para que pueda utilizar cada tipo de proveedor, visita la sección de xref:ibm-db2:operations-guide.adoc#_configuración_del_proveedor_de_conexión[Configuración del proveedor de conexión] en la guía de operaciones.

Para realizar la virtualización del conector SSCC IBM Db2 debes añadir alguna de las tablas que contiene en una colección de _Stratio Data Governance_ y dar permisos en _Stratio GoSec_. Una vez hecho eso, los datos son accesibles en el resto de módulos de _Stratio Generative AI Data Fabric_. En la siguiente imagen puedes ver cómo aparecen:

image::db2-coleccion-tecnica.png[BDL]

Para crear una tabla directamente en el catálogo de _Stratio Virtualizer_ puedes ejecutar las siguientes sentencias:

* Si quieres crear la tabla con el modo nativo:

[source,sql]
----
CREATE TABLE db2_table USING com.stratio.crossdata.connector.db2 OPTIONS (
    `stratiosecurity` 'true',
    `stratiosecuritymode` 'custom_sscc',
    `stratiocredentials` '<nombre_secreto>',
    `stratiossccdriver` 'com.stratio.connectors.ssccdb2.Db2DriverMD5',
    `driver` 'com.ibm.db2.jcc.DB2Driver',
    `url` 'jdbc:db2://<db2_host>:<db2_port>/<db2_database>',
    `dbtable` '<nombre_tabla>'
)
----

* Si quieres crear la tabla sin el modo nativo:

[source,sql]
----
CREATE TABLE db2_table USING jdbc OPTIONS (
    `stratiosecurity` 'true',
    `stratiosecuritymode` 'custom_sscc',
    `stratiocredentials` '<nombre_secreto>',
    `stratiossccdriver` 'com.stratio.connectors.ssccdb2.Db2DriverMD5',
    `driver` 'com.ibm.db2.jcc.DB2Driver',
    `url` 'jdbc:db2://<db2_host>:<db2_port>/<db2_database>',
    `dbtable` '<nombre_tabla>'
)
----

== Transforma tus datos

=== _Stratio Rocket_

En _Stratio Rocket_ puedes utilizar cualquier _workflow_ para realizar tus operaciones con los datos de IBM Db2. Utiliza cajas de _Crossdata_ o de tipo SQL como entrada de tus _workflows_.

La escritura en IBM Db2 está soportada. Utiliza una caja de _Crossdata_ para realizar escrituras directamente sobre la base de datos. Debes apuntar a la tabla que ya existe en una colección concreta. _Stratio Rocket_ realizará las escrituras directamente sobre la tabla original IBM Db2. Cuando realices una escritura, debes de escribir en mayúscula el esquema y la tabla.

La mejor forma de comprobar el acceso al dato es mediante *el catálogo*. El conector puede trabajar con reglas de calidad para realizar comprobaciones sobre los datos.

En _Stratio Rocket_ se puede acceder a la colección virtualizada de IBM Db2 mediante consultas SQL directamente o mediante un _workflow_, en las siguientes imágenes se muestra un ejemplo de ambas:

image::db2-vista-catalogo.png[BDL]

image::db2-workflow.png[BDL]

Cuando se haya ejecutado un _workflow_ de _Stratio Rocket_, puedes visualizar su linaje técnico accediendo sobre la tabla en la colección técnica, como se muestra en la imagen:

image::db2-linage.png[Linaje,500]

=== _Stratio Intelligence_

Puedes utilizar una sesión de _Crossdata_ en _Stratio Intelligence_ para acceder rápidamente a tus datos mediante un Jupyter Notebook (utiliza una sesión de PySpark). A continuación se muestra un ejemplo para que puedas hacerlo.

Usa siempre la referencia de tu colección anexa a punto con tu tabla.

[source,python]
----
from pystratio.xd.xdsession import XDSession
xd = XDSession(sc)
xd.sql("SELECT * FROM db2_col.YOUR_TABLE LIMIT 3").show()
----

Se puede comprobar cómo se accede a los datos desde _Stratio Intelligence_ en la xref:ROOT:quick-start-guide.adoc#_stratio_intelligence[guía de inicio rápido general].
