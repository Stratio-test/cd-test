= Guía de usuario

== Descripción

El conector SSCC PostgreSQL® te permite la integración completa de PostgreSQL® en _Stratio Generative AI Data Fabric_.

Las funcionalidades y versiones soportadas se encuentran en la xref:postgres:compatibility-matrix.adoc[matriz de compatibilidad].

== Descubre tus datos

=== Conoce tus datos

Además de lo que se muestra en xref:stratio-data-governance:user-manual:from-a-data-store-to-a-dictionary.adoc#_tablas_y_columnas[__Stratio Data Governance__], también puedes encontrar los atributos técnicos extraídos de los recursos de PostgreSQL®. Se extraen todos los metadatos que proporciona PostgreSQL® y se añaden a la interfaz de usuario de _Stratio Data Governance_ tanto en tabla como en columna.

* Los metadatos extraídos en tabla son los siguientes:
+
image:postgres-table-metadata.png[]

* Los metadatos extraídos en columna son los siguientes:
+
image:postgres-column-metadata1.png[]

NOTE: Las vistas en PostgreSQL® están soportadas pero se muestran como tablas en la interfaz de usuario de _Stratio Data Governance_.

=== Descubrimiento con optimización automática

La optimización realizada por el agente SSCC PostgreSQL® se realiza a la vez que el descubrimiento en la misma jerarquía de datos de PostgreSQL®, siempre y cuando se haya activado la opción de optimización automática durante el proceso de configuración del agente de descubrimiento.

El agente, además de los añadidos durante el proceso de descubrimiento, asociará metadatos técnicos o de sistema a los niveles de la jerarquía de datos relacionados con la optimización de la tabla:

. *_Tabla_*, accesible a través del botón "System attributes" o del enlace "Connector Attributes":
** _sscc.optimizer.partitionColumn_: columna utilizada para particionar la tabla.
** _sscc.optimizer.lowerBound_: límite inferior de la partición.
** _sscc.optimizer.upperBound_: límite superior de la partición.
** _sscc.optimizer.numPartitions_: número de particiones que se van a utilizar para particionar la tabla.
** _sscc.optimizer.count_: número de filas de la tabla.
+
image::postgres-optimizer-table-attrs.png[]

. *_Columna_*, accesible a través del botón "System attributes" o del enlace "Connector Attributes", tras seleccionarla en la lista.
** _DensityRatio_: relación de densidad de la columna. Calcula lo bien que se distribuyen los valores de la columna. Un valor cercano a 1 o mayor indica que los valores están mal distribuidos, mientras que un valor cercano a 0 indica que los valores están bien distribuidos.
** _MaxValue_: valor máximo de la columna.
** _MinValue_: valor mínimo de la columna.
** _NullValues_: número de valores nulos de la columna.
** _DistinctValues_: número de valores distintos de la columna.
+
image::postgres-optimizer-column-attrs.png[]
+
NOTE: No todos los metadatos de optimización de la columna se encuentran disponibles en la interfaz de usuario de _Stratio Data Governance_. Esto es debido al _Granularity optimization level_ que se haya elegido durante el proceso de configuración del agente de descubrimiento.

=== Optimización manual

Esta funcionalidad permite optimizar manualmente las tablas descubiertas. La optimización manual se puede realizar independientemente de si se ha activado o no la opción de optimización automática durante el proceso de configuración del agente de descubrimiento.

Para optimizar una tabla manualmente, puedes añadir los siguientes atributos a la tabla en la BDL durante el proceso de virtualización en la creación de las _Data Collections_:

* *bdl.options.partitionColumn*: columna utilizada para particionar la tabla.
* *bdl.options.lowerBound*: límite inferior de la partición.
* *bdl.options.upperBound*: límite superior de la partición.
* *bdl.options.numPartitions*: número de particiones que se van a utilizar para particionar la tabla.

NOTE: Los atributos de optimización de la tabla mediante la optimización manual prevalecerán y tendrán prioridad sobre los atributos de optimización de la tabla descubierta.

TIP: Puedes leer más acerca de sus características en su xref:stratio-virtualizer:user-guide:user-guide.adoc#_trabajar_con_stratio_virtualizer[guía de usuario].

=== Virtualización de la BDL

El proceso de descubrimiento es asíncrono. Una vez terminado,se podrá visualizar desde la interfaz de de _Stratio Data Governance_.

El conector soporta xref:stratio-data-governance:user-manual:semantic-mapping.adoc[el mapeo semántico] usando el modo operacional.

El conector soporta la personalización del acceso al dato en las tablas virtualizadas mediante xref:stratio-data-governance:user-manual:bdl-virtualization.adoc#_atributos_personalizados_de_bdl[atributos personalizados de BDL].

NOTE: Puedes consultar cómo crear atributos en la xref:stratio-data-governance:user-manual/addition-of-metadata[guía de usuario] de _Stratio Data Governance_.

TIP: Para más detalles del uso de la BDL consulta la xref:stratio-data-governance:user-manual:data-processing-with-bdl.adoc[documentación de procesamiento de datos con BDL].

== Virtualiza tus datos

Una vez descubiertas las tablas, es posible añadirlas a una vista técnica de una colección. Todos los parámetros configurables del descubrimiento y los modificados desde la interfaz de usuario de _Stratio Data Governance_ se propagan en las colecciones donde se añada esa tabla.

TIP: Para saber más sobre cómo gestionar las colecciones puedes consultar xref:stratio-data-governance:user-manual:collections.adoc[la guía de usuario de _Stratio Data Governance_].

IMPORTANT: Ten en cuenta que, para virtualizar las tablas descubiertas, es necesario gestionar las xref:stratio-gosec:operations-manual:data-access/manage-policies/manage-domains-policies.adoc[políticas de dominios] a través de _Stratio GoSec_.

Para crear una tabla directamente en el catálogo de _Stratio Virtualizer_ puedes ejecutar las siguientes sentencias:

* Si quieres crear la tabla para cualquier método de autenticación *sin el modo nativo*:
+
[source,sql]
----
CREATE TABLE postgresql_table USING jdbc OPTIONS (
    `stratiosecurity` 'true',
    `stratiosecuritymode` 'custom_sscc',
    `stratiocredentials` '<nombre_secreto>',
    `stratiossccdriver` 'com.stratio.connectors.ssccpostgresql.PostgreSQLDriver<service_security>',
    `driver` 'embedded.com.stratio.connectors.ssccpostgresql.org.postgresql.Driver',
    `url` '<service_url>',
    `dbtable` '<nombre_schema>.<nombre_tabla>'
)
----

* Si quieres crear la tabla para cualquier método de autenticación *con el modo nativo*:
+
[source,sql]
----
CREATE TABLE postgresql_table USING com.stratio.crossdata.connector.postgresql OPTIONS (
    `stratiosecurity` 'true',
    `stratiosecuritymode` 'custom_sscc',
    `stratiocredentials` '<nombre_secreto>',
    `stratiossccdriver` 'com.stratio.connectors.ssccpostgresql.PostgreSQLDriver<service_security>',
    `driver` 'embedded.com.stratio.connectors.ssccpostgresql.org.postgresql.Driver',
    `url` '<service_url>',
    `dbtable` '<nombre_schema>.<nombre_tabla>'
)
----

=== Acceso nativo a PostgreSQL®

El conector incluye una implementación del xref:stratio-virtualizer:architecture:features.adoc#_acceso_nativo_a_los_almacenes_de_datos[dialecto nativo de _Stratio Virtualizer_]. Puedes consultar cómo configurarlo globalmente en su xref:stratio-virtualizer:operations-guide:configuration/processing-configuration.adoc#_mejoras_de_stratio_virtualizer_al_push_down_de_spark[guía de operaciones].

TIP: Para comprobar si una tabla del catálogo soporta el dialecto nativo, puedes comprobar su _provider_: el resultado de la sentencia `show create table my_table` debe contener "using com.stratio.crossdata.connector.postgresql".

El dialecto nativo soporta un subconjunto del https://archive.apache.org/dist/spark/docs/3.1.1/sql-ref.html[dialecto SQL de Apache Spark™]. Las sentencias no soportadas podrían ejecutarse igualmente pero sin realizar el _full push-down_ que proporciona el dialecto nativo, por lo que el rendimiento puede verse afectado para tablas con un gran número de filas.

TIP: Puedes consultar el subconjunto del dialecto SQL soportado en xref:postgres:user-guide/native-coverage.adoc[la referencia de cobertura del dialecto nativo].

=== _Stratio Rocket_

Una vez virtualizados los datos, es posible acceder desde _Stratio Rocket_ mediante:

* El catálogo.
+
image:postgres-rocket-catalog.png[]

* Dentro de los _workflows_, haciendo uso del _input_ de xref:stratio-rocket:user-guide:workflow-asset/data-inputs.adoc#_stratio_virtualizer[_Stratio Virtualizer_]. Es posible forzar el acceso mediante el dialecto nativo marcando la casilla "Force query execution with native connectors".
+
image:postgres-rocket-virtualizer-input.png[]

=== _Stratio Intelligence_

Puedes comprobar cómo se accede a los datos desde _Stratio Intelligence_ en la xref:ROOT:quick-start-guide.adoc#_stratio_intelligence[guía de inicio rápido general].
