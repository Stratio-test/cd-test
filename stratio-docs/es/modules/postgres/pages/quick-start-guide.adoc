= Guía de inicio rápido

El propósito de esta guía es explicar brevemente cómo integrar una base de datos PostgreSQL® en la plataforma _Stratio Generative AI Data Fabric_.

== Prerrequisitos

Puedes encontrar los prerrequisitos para la instalación del conector de PostgreSQL® en la xref:postgres:operations-guide.adoc#_prerrequisitos[guía de operaciones].

== Descubre tus datos

=== Agente de descubrimiento

* Para instalar un agente de descubrimiento de _Stratio Data Governance_ para un PostgreSQL® externo, debes seleccionar en '_Stratio Command Center_' -> 'Deploy a Service' -> 'Connectors RDBMS' el agente "PostgreSQL® Agent (External)".
+
En la instalación debes añadir la URL del repositorio de conectores donde se almacene el artefacto `sscc-postgresql-0.3_2.12-1.1.x` y subir las credenciales de acceso a _Stratio KMS_.
+
Los campos más importantes a rellenar son:

** *_Root discovery path_*: ruta desde la cual quieres descubrir los metadatos de forma recursiva. Ej: `/<base_de_datos>`.
** *_Access credentials_*: nombre del secreto creado en _Stratio KMS_. Ej: `<nombre_del_secreto>`.
** *_Data store driver location_*: URL donde se encuentra el artefacto en el repositorio de conectores que contendrá el JAR del _driver JDBC_ elegido. Ej: `http://connectors.<tenant>-<namespace>/<path>/v1/api/artifact/sscc-postgresql-0.3_2.12-1.1.x.jar`.

TIP: Puedes consultar más información sobre el resto de parámetros de configuración en la xref:postgres:operations-guide.adoc#_agente_de_descubrimiento[guía de operaciones].

* Para instalar un agente de descubrimiento de _Stratio Data Governance_ para un PostgreSQL® interno, debes seleccionar en *'_Stratio Command Center_' -> 'Deploy a Service' -> 'Connectors RDBMS' el agente "PostgreSQL® Agent (Internal)".
+
Los campos más importantes a rellenar son:

*** *_Define a namespace_*: selecciona el espacio de nombres sobre el que quieras instalar el agente de descubrimiento.
*** *_PostgreSQL® to be discovered_*: selecciona el servicio PostgreSQL® que quieras descubrir.
*** *_PostgreSQL® used for policy creation_*: selecciona el PostgreSQL® utilizado para la creación de políticas.
*** *_Init path_*: las bases de datos que serán descubiertas. Ejemplo: `/db1,/db2`.

== Virtualiza tus datos

=== Agente de Eureka

Para el uso de la BDL es necesario configurar el agente de Eureka con el conector de PostgreSQL®. Para ello, hay que añadir la URL del repositorio de conectores del artefacto `sscc-postgresql-0.3_2.12-1.1.x` en la variable 'Customized deployment' -> 'Settings' -> `Additional jars`.

image::postgres-bdl-conf.png[]

NOTE: Recuerda que, si ya tienes más de un artefacto en la lista, se deben añadir los siguientes separándolos por una coma.

=== _Stratio Virtualizer_

Para el uso de _Stratio Virtualizer_ es necesario tener configurado el conector de PostgreSQL®. Para ello, debes añadir la URL del artefacto `sscc-postgresql-0.3_2.12-1.1.x` en la variable 'Customized deployment' -> 'Environment' -> 'External datastores' -> `JDBC Drivers URL List` y además subir las credenciales de acceso a _Stratio KMS_.

image::postgres-virtualizer-conf.png[]

== Transforma tus datos

=== _Stratio Rocket_

Para el uso de _Stratio Rocket_ es necesario tener configurado el conector de PostgreSQL®. Para ello, debes añadir la URL del artefacto `sscc-postgresql-0.3_2.12-1.1.x` en la variable 'Customized deployment' -> 'Settings' -> 'Classpath' -> `Rocket extra jars` y además subir las credenciales de acceso para los _workflows_ y para _Stratio Rocket_ a _Stratio KMS_.

image::postgres-rocket-conf.png[]

TIP: Puedes consultar más información sobre el resto de parámetros de configuración en la xref:postgres:operations-guide.adoc#rocket-configuration[guía de operaciones].

=== _Stratio Intelligence_

Previo a la integración con el conector es necesario configurar _Stratio Intelligence_. Se deben añadir las siguientes propiedades:

* `INTERPOLATED_ANALYTIC_ENV_CROSSDATA_CATALOG_SECRET_INSTANCE_NAME`: ${username}
* `ANALYTIC_ENV_VAULT_PATH`: "people".
* `ANALYTIC_ENV_REQUESTS_CA_BUNDLE`: /opt/sds/stratio_analytic/security/ca-bundle.pem
* `ANALYTIC_ENV_HIDE_VAULT_TOKEN`: "false"

Además, en el entorno multiusuario se debe tener activada la opción "Allow artifact deployment" y tener en la ruta el valor _artifacts_.

Una vez esté configurado _Stratio Intelligence_, tienes que añadir el conector de PostgreSQL® en el directorio _artifacts/spark++_++jars_ y subir las credenciales a _Stratio KMS_.

Puedes descargar el artefacto necesario en la carpeta _artifacts/spark++_++jars_ dentro del _workspace_ de _Stratio Intelligence_, realizando la siguiente petición cURL:

[source,bash]
----
curl http://connectors.<tenant>-<namespace>/<path>/v1/api/artifact/sscc-postgresql-0.3_2.12-1.1.x --output sscc-postgresql-0.3_2.12-1.1.x
----
