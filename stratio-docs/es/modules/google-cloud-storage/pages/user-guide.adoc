= Guía de usuario

El propósito de esta guía es explicar el funcionamiento particular del conector SSCC Google Cloud Storage para un usuario en la plataforma _Stratio Generative AI Data Fabric_.

== Descripción

Google Cloud Storage es un almacenamiento externo incluido en Google que se puede emplear para almacenar cualquier tipo de objeto que permita usos como el almacenamiento para aplicaciones de Internet, _backup_ y _restore_, recuperación ante desastres, archivos de datos, lagos de datos para análisis y almacenamiento híbrido en la nube.

_Stratio Generative AI Data Fabric_ puede realizar tareas de descubrimiento de los metadatos de Google Cloud Storage. La jerarquía soportada por el conector es:

. Cuenta de Google Cloud Storage.
. _Bucket_.
. Uno o varios directorios.
. Fichero.

TIP: Consulta la https://cloud.google.com/docs?hl=es[guía oficial de primeros pasos Google Cloud Storage] para más información.

== Descubre tus datos

Para que el conector pueda acceder a tus datos deberás tener un usuario creado, como se muestra en los xref:google-cloud-storage:operations-guide.adoc#_prerrequisitos[prerrequisitos] de la guía de operaciones, con el que __Stratio Generative AI Data Fabric__ realice el descubrimiento. Si la cuenta no tiene los permisos suficientes, el proceso de descubrimiento fallará.

Estas son las vistas en el descubrimiento:

*Cuentas*

image::vista_general_cuentas_gcs.png[Governance,450,100]

Atributos:

- _type_: tipo de almacén de datos Google Cloud Storage.

*Buckets*

image::vista_general_buckets_gcs.png[Governance,450,100]

Atributos:

- _type_: tipo de almacén de datos Google Cloud Storage.

*Directorios*

image::vista_general_dir_gcs.png[]

Atributos:

- _type_: tipo de almacén de datos Google Cloud Storage.
- _bucket_: nombre del _bucket_ al que pertenece.
- _isDirectory_: es directorio.
- _isRegularFile_: es fichero.
- _path_: ruta, sin contar el _bucket_.
- _project_: nombre de la cuenta a la que pertenece.
- _storageClass_: clase de almacenamiento utilizada en Google Cloud Storage.

*Tabla*

image::vista_general_tabla_gcs.png[Governance,450,100]

Atributos:

- _bucket_: nombre de la cuenta a la que pertenece.
- _contentType_: tipo de contenido.
- _creationTime_: hora de creación del _blob_.
- _format_: formato del fichero.
- _generation_: la generación de metadatos del _bucket_.
- _hrCreationTime_: fecha de creación.
- _hrLastModified_: fecha de última modificación.
- _hrSize_: tamaño de los datos en _bytes_.
- _isDirectory_: es un directorio (_true/false_).
- _isRegularFile_: es un fichero (_true/false_).
- _lastModified_: la última hora de modificación del _blob's metadata_.
- _mediaLink_: enlace de descarga.
- _path_: nombre del _blob_.
- _project_: ID del proyecto.
- _size_: tamaño del fichero en _bytes_.
- _storageClass_: clase de almacenamiento utilizada en Google Cloud Storage.

*Columnas*

image::vista_columna_gcs.png[Governance,450,100]

Atributos:

- _type_: tipo de almacén de datos Google Cloud Storage.
- _sourceType_: tipo original de la columna en el almacén de datos.

El agente _Cloud_ funciona de la siguiente manera:

* Es capaz de identificar sistemas de ficheros jerárquicos a partir de la raíz identificada a primer nivel en un _bucket_ Google Cloud Storage.
* Si dentro de cualquier directorio encuentra xref:google-cloud-storage:compatibility-matrix.adoc#_formatos_soportados[un fichero soportado], es capaz de obtener los metadatos y representarlo como si fuese una tabla de tipo SQL.

== Virtualiza tus datos

Una vez descubiertas las tablas, puedes añadirlas a la vista técnica de una colección. Todos los parámetros configurables del descubrimiento y los modificados desde la interfaz de usuario de _Stratio Data Governance_ se propagan en las colecciones donde se añada esa tabla.

TIP: Puedes leer más acerca de sus características en la xref:stratio-virtualizer:user-guide:user-guide.adoc#_trabajar_con_stratio_virtualizer[guía de usuario de __Stratio Virtualizer__].

NOTE: Ten en cuenta que para virtualizar las tablas descubiertas es necesario gestionar las xref:stratio-gosec:operations-manual:data-access/manage-policies/manage-domains-policies.adoc[políticas de dominios] a través de _Stratio GoSec_.

Para crear una tabla directamente en el catálogo de _Stratio Virtualizer_ puedes ejecutar una de las siguientes sentencias:

* Usando una credencial global tal y como se describe en xref:google-cloud-storage:operations-guide.adoc#direct-access-to-resources[la guía de operaciones].
+
[source,sql]
----
CREATE TABLE `gcs_table` USING parquet LOCATION 'gcs://my-bucket/path/to/my/file.parquet'
----

* Usando una credencial específica para la tabla.
** Con autenticación _Service Account_.
+
[source,sql]
----
CREATE TABLE `gcs_table`
USING parquet
OPTIONS (
  `stratiocredentials` 'gcs-secret',
  `stratiosecurity` 'true',
  `stratiossccdriver` 'com.stratio.connectors.ssccgcs.GCSDriverServiceAccount',
  `stratiosecuritymode` 'custom_sscc'
) LOCATION 'gcs://my-bucket/path/to/my/file.parquet'
----

== Transforma tus datos

=== _Stratio Rocket_

En _Stratio Rocket_, puedes utilizar cualquier _workflow_ para realizar tus operaciones con los datos de Google Cloud Storage. Utiliza cajas de _Stratio Crossdata_ o de tipo SQL como entrada de tus _workflows_:

image::rocket_workflow_1.png[Rocket Workflow Crossdata Box]

image::rocket_workflow_2.png[Rocket Workflow]

También puedes acceder directamente mediante el catálogo:

image::rocket_catalogo.png[Catalogo de Rocket]

image::rocket_catalogo_sql.png[SQL en catalogo de Rocket]

La escritura en Google Cloud Storage está soportada. Utiliza una caja de _Stratio Crossdata_ para realizar escrituras directamente sobre otro fichero. En este caso, debes realizar escrituras sobre un fichero concreto.

El conector puede trabajar con reglas de calidad para realizar tus comprobaciones sobre los datos de Google Cloud Storage.

Cuando se ejecuta un _workflow_ de _Stratio Rocket_, puedes visualizar su linaje técnico accediendo sobre la tabla en la colección técnica, como se muestra en la imagen:

image::linage_gcs.png[Linaje,500]

=== _Stratio Intelligence_

Puedes utilizar una sesión de _Stratio Virtualizer_ en _Stratio Intelligence_ para acceder rápidamente a tus datos mediante un Jupyter Notebook (utiliza una sesión de PySpark). A continuación se muestra un ejemplo para que puedas hacerlo:

image::intelligence_virtualized_table_1.png[Intelligence virtualized table 1]

image::intelligence_virtualized_table_2.png[Intelligence virtualized table 2]

TIP: Para más información acerca de la consistencia de datos desde _Stratio Intelligence_, ve al xref:ROOT:commiters.adoc[documento de integración].
