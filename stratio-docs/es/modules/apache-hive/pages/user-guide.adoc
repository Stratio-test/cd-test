= Guía de usuario

== Descripción

El conector SSCC Apache Hive™ te permite la integración completa de Apache Hive™ en _Stratio Generative AI Data Fabric_.

Las funcionalidades y versiones soportadas se encuentran en la xref:apache-hive:compatibility-matrix.adoc[matriz de compatibilidad].

== Descubre tus datos

El descubrimiento realizado por el agente SSCC Apache Hive™ hará visible y navegable en _Stratio Data Governance_ la jerarquía de datos en Apache Hive™:

* Esquemas
* Tablas
* Columnas

image::hive-governance-datastore.png[]

TIP: Puedes leer más acerca del uso del almacén de datos en la xref:stratio-data-governance:user-manual:from-a-data-store-to-a-dictionary.adoc[Guía de usuario de _Stratio Data Governance_].

El agente también asociará metadatos técnicos o de sistema a los niveles de la jerarquía de datos:

. *Almacén de datos*, accesible a través del botón "System attributes":
** Generales
+
--
*** _Version_: versión del conector que realizó el descubrimiento.
*** _URL_: URL JDBC usada para la conexión con Apache Hive™.
*** _Security_: tipo de seguridad utilizado. Posibles valores: MD5 (usuario y contraseña) o KRB (Kerberos).
--
+
image::hive-governance-datastore-system-attrs.png[]
+
** Atributos del origen de datos: nombre y versión de la base de datos y clase del _driver JDBC_ utilizada.
+
image::hive-governance-datastore-system-attrs2.png[]

. *_Tabla_*, accesible a través del botón "System attributes" o del enlace "Connector attributes":
** _database_: esquema donde está incluida la tabla.
** _format_: formato del fichero. Posibles valores: "text", "csv", "parquet" y el resto de formatos soportados por Apache Hive™ y el conector.
** _location_: localización del fichero en Apache Hive™.
** _table_: nombre de la tabla.
** _tableType_: tipo de tabla. Posibles valores: "TABLE" y "VIEW".
+
image::hive-governance-table-system-attrs.png[]

. *_Columna_*, accesible a través del botón "System attributes" o del enlace "Connector attributes", tras seleccionarla en la lista.
** Propiedades (sólo en _System attributes_): precisión, escala y si el tipo tiene signo.
** Atributos del conector: tipo de almacén de datos (_HIVE_) y nombre del tipo de datos original en Apache Hive™.
+
image::hive-governance-column-system-attrs.png[]

=== Virtualización de la BDL

El conector soporta la personalización del acceso al dato en las tablas virtualizadas mediante xref:stratio-data-governance:user-manual:bdl-virtualization.adoc#_atributos_personalizados_de_bdl[atributos avanzados de BDL] de _Stratio Data Governance_, modificables desde la interfaz de usuario:

* *bdl.options.virtualizer.native*: los posibles valores son "True" y "False". "True" si el usuario quiere acceder al dato con el xref:stratio-virtualizer:user-guide:what-can-i-do-with-stratio-virtualizer.adoc#_consultas_nativas[dialecto nativo] de _Stratio Virtualizer_. Si se configura este atributo, se sobrescribirá la configuración por defecto ("True").
* *bdl.options.native.filter*: filtro aplicado sobre la virtualización de la tabla en caso de que el modo de acceso al dato sea con el dialecto nativo de _Stratio Virtualizer_.

Para acceder a los datos almacenados de manera nativa en el sistema de ficheros distribuido al que lanza sus consultas Apache Hive™, tienes que configurar previamente el acceso multi-HDFS como se indica en la xref:apache-hadoop-hdfs:operations-guide.adoc#_stratio_virtualizer[documentación] y además añadir los siguientes atributos en las tablas virtualizadas donde se quiera configurar el acceso:

* *bdl.options.hive.distributed*: tiene que estar a "True".
* *bdl.options.hive.distributed.external.hdfs*: tiene que tener el valor indicado en la instalación de _Stratio Virtualizer_ en 'Environment' -> 'Enable multiple HDFS' -> 'Enable HDFS' -> 'External hdfs name'.
+
image::hive-distributed-attrs.png[]

TIP: Para más detalles del uso de la BDL consulta la xref:stratio-data-governance:user-manual:data-processing-with-bdl.adoc[documentación de procesamiento de datos con BDL].

== Virtualiza tus datos

Una vez descubiertas las tablas, es posible añadirlas a una vista técnica de una colección. Todos los parámetros configurables del descubrimiento y los modificados desde la interfaz de usuario de _Stratio Data Governance_ se propagan en las colecciones donde se añada esa tabla.

TIP: Puedes leer más acerca de sus características en su xref:stratio-virtualizer:user-guide:user-guide.adoc#_trabajar_con_stratio_virtualizer[guía de usuario].

IMPORTANT: Ten en cuenta que, para virtualizar las tablas descubiertas, es necesario gestionar las xref:stratio-gosec:operations-manual:data-access/manage-policies/manage-domains-policies.adoc[políticas de dominios] a través de _Stratio GoSec_.

Para crear una tabla directamente en el catálogo de _Stratio Virtualizer_ puedes ejecutar la siguiente sentencia:

[source,sql]
----
CREATE TABLE hive_table_krb USING com.stratio.crossdata.connector.hive OPTIONS (
    `stratiosecurity` 'true',
    `stratiosecuritymode` 'custom_sscc',
    `stratiocredentials` '<nombre_secreto>',
    `stratiossccdriver` 'com.stratio.connectors.sscchive.HiveDriverKRB',
    `url` 'jdbc:hive2://<hive_host>:<hive_port>/<hive_database>;principal=<principal_name>',
    `driver` 'org.apache.hive312.jdbc.HiveDriver',
    `dbtable` '<nombre_tabla>'
)
----

=== Acceso nativo a Apache Hive™

El conector incluye una implementación del xref:stratio-virtualizer:architecture:features.adoc#_acceso_nativo_a_los_almacenes_de_datos[dialecto nativo de _Stratio Virtualizer_]. Puedes consultar cómo configurarlo globalmente en su xref:stratio-virtualizer:operations-guide:configuration/processing-configuration.adoc#_mejoras_de_stratio_virtualizer_al_push_down_de_spark[guía de operaciones].

TIP: Para comprobar si una tabla del catálogo soporta el dialecto nativo, puedes comprobar su `provider`: el resultado de la sentencia `show create table my_table` debe contener `using com.stratio.crossdata.connector.hive`.

El dialecto nativo soporta un subconjunto del https://archive.apache.org/dist/spark/docs/3.1.1/sql-ref.html[dialecto SQL de Apache Spark™]. Las sentencias no soportadas podrían ejecutarse igualmente pero sin realizar el _full push-down_ que proporciona el dialecto nativo, por lo que el rendimiento puede verse afectado para tablas con un gran número de filas.

TIP: Puedes consultar el subconjunto del dialecto SQL soportado en xref:apache-hive:user-guide/native-coverage.adoc[la referencia de cobertura del dialecto nativo].

== Transforma tus datos

=== _Stratio Rocket_

Una vez virtualizados los datos, es posible acceder desde _Stratio Rocket_ mediante:

* El catálogo.
+
image::hive-rocket-catalog.png[]

* Dentro de los _workflows_, haciendo uso del _input_ de xref:stratio-rocket:user-guide:workflow-asset/data-inputs.adoc#_stratio_virtualizer[__Stratio Virtualizer__]. Es posible forzar el acceso mediante el dialecto nativo de _Stratio Virtualizer_ marcando la casilla "Force query execution with native connectors".
+
image::hive-rocket_virtualizer_input.png[]

=== _Stratio Intelligence_

Se puede comprobar cómo se accede a los datos desde _Stratio Intelligence_ en la xref:ROOT:quick-start-guide.adoc#_stratio_intelligence[Guía de inicio rápido general].
