= Operations guide

== Description

The SSCC Salesforce connector enables full integration of Salesforce into _Stratio Generative AI Data Fabric_.

Both the supported features and the different versions are found in the xref:salesforce:compatibility-matrix.adoc[compatibility matrix].

=== Authentication

Currently, the connector only supports *username and password* authentication.

== Prerequisites

* Install the xref:connectors-repository:operations-guide.adoc#_installation[connectors repository].
+
IMPORTANT: In the connectors repository, the `sscc-salesforce-0.3_2.12-1.1.x` artifact will be available at the URL `http://connectors.tenant-my_namespace/v1/api/artifact/<artifact_name>`.

* Have the xref:salesforce:quick-start-guide.adoc#_discovery_agent[_Stratio KMS_ UI] accessible.
* Have a Salesforce platform.
* Have a Salesforce account.
* Create secrets in _Stratio KMS_. Currently, the connector only supports username and password authentication.
+
--
The secret to be uploaded consists of two keys:

** _user_ : `<user>`, corresponds to the user with which you login on the Salesforce platform.
** _pass_ : `<password><security token>`, in this case, the password corresponds to the user's password for login in Salesforce. To get the security token, access your personal settings and click on "Reset my security token". Confirm the action and you will receive an email with it.
--
+
This secret must be uploaded to the following _Stratio KMS_ directories:

** *Discovery agent*: `userland/passwords/<agent_name>/<secret_name>`.
** *_Stratio Virtualizer_*: `userland/certificates/<virtualizer_name>.<namespace_virtualizer>`.
** *_Stratio Rocket_*: `userland/passwords/<rocket_name>.<namespace_rocket>/<secret_name>`.
** *_Workflows_ de _Stratio Rocket_*: `userland/passwords/execution-identity-<rocket_name>.<namespace_rocket>/<secret_name>`.
** *_Stratio Intelligence_*: `people/certificates/<intelligence_user_name>`.

== Discover your data

=== Discovery agent

To install the _Stratio Data Governance_ discovery agent for Salesforce, go to '_Stratio Command Center_' -> 'Deploy a Service' -> 'Connectors Data Warehouse' and select "Salesforce Agent".

The fields to be filled in for the installation are:

* *_General_*:
** *_Service ID_*: agent's unique identifier.
** *_Name of the Service_*: name displayed in DC/OS.
* *_Metadata Data store (PostgreSQL®)_*
** *_Host_*: the PostgreSQL® instance that stores the discovered metadata. Example: _poolpostgresgov_.
* *_Configuration of the service to be discovered_*
** *_Service to be discovered_*
*** *_Service name_*: name that will be used to identify this data store in _Stratio Data Governance_. It is the one that will be displayed in the UI.
*** *_Init path_*: path of the Salesforce _namespace_ for which you want to discover the metadata. Example: _/d09000008wppteac-dev-ed_.
+
The _namespace_ can be found as part of the Salesforce URL when you login. Example: `https://<namespace>.lightning.force.com/`.
+
image::salesforce-cct-deployment-1.png[]
+
** *_Resource datastore connection configuration_*
*** *_Custom datastore service security_*: only supports MD5.
*** *_Access credentials_*: name of the secret in Vault with authorization credentials. Example: _salesforce-secret_.
*** *_SSCC driver location_*: URL where the artifact that will contain the JAR of the SSCC Salesforce connector is located in the connectors repository. Example: `http://connectors.<tenant>-<namespace>/v1/api/artifact/sscc-salesforce-0.3_2.12-1.1.x.jar`.
*** *_Salesforce concurrent connections_*: number of parallelism units to perform discovery. It is recommended to leave the default value or use caution when increasing it.
+
image::salesforce-cct-deployment-2.png[]
+
*** *_Enable connection through proxy_*: `(True/False)`. Enable connection through proxy.
*** *_Proxy address_*: if connection through proxy is enabled, it is necessary to specify the host and port of the proxy in the format `<host>:<port>`.
*** *_Require proxy authentication_*: `(True/False)`. Whether the proxy requires authentication. If `True`, you need to upload the secret in the service path with the name `salesforce-proxy-secret`.
+
image::salesforce-cct-deployment-3.png[]

The discovery process is asynchronous. Once the discovery is finished you can view it from the _Stratio Data Governance_ UI.

image::salesfoce-governance-discovery.png[]

image::salesfoce-governance-discovery-2.png[]

== Virtualize your data

IMPORTANT: Note that, to virtualize the discovered tables, you need to manage the xref:stratio-gosec:operations-manual:data-access/manage-policies/manage-domains-policies.adoc[domain policies] through _Stratio GoSec_.

=== Eureka Agent

To use the BDL, you need to configure the Eureka agent with the SSCC Salesforce connector. To do this, simply add the URL of the `sscc-salesforce-0.3_2.12-1.1.x` artifact in the 'Customized deployment' -> 'Settings' -> `Additional jars` variable.

You should be left with a configuration similar to this:

* _Additional jars_: `http://connectors.<tenant>-<namespace>/v1/api/artifact/sscc-salesforce-0.3_2.12-1.1.x.jar`.

As shown in the following image:

image::salesforce-eureka-environment.png[]

NOTE: Remember that, if you already have more than one artifact in the list, you have to add the following ones, separating them with a comma.

TIP: See here for xref:stratio-data-governance:user-manual:data-processing-with-bdl.adoc[more information about data processing with BDL].

=== _Stratio Virtualizer_

_Stratio Virtualizer_ supports interaction with Salesforce through the SSCC Salesforce connector. This integration has certain requirements:

* The following _Stratio Virtualizer_ deployment fields must be modified in _Stratio Command Center_:
** 'Customized deployment' -> 'Environment' -> 'External datastores' -> 'JDBC Integration'.
*** *_JDBC Integration_*: `True`.
** 'Customized deployment' -> 'Environment' -> 'External datastores' -> 'JDBC Drivers URL List'.
*** *_JDBC Drivers URL List_*: `http://connectors.<tenant>-<namespace>/v1/api/artifact/sscc-salesforce-0.3_2.12-1.1.x.jar`.

You should be left with a configuration similar to the following image:

image::salesforce-virtualizer-environment.png[]

NOTE: Remember that, if you already have more than one artifact in the list, you have to add the following ones, separating them with a comma.

== Transform your data

=== _Stratio Rocket_

==== Managing the driver

To use _Stratio Rocket_ the SSCC Salesforce connector must be configured. To do this, the URL of the `sscc-salesforce-0.3_2.12-1.1.x` artifact must be added in the 'Customized deployment' -> 'Settings' -> 'Classpath' -> `Rocket extra jars` variable of _Stratio Command Center_.

* *_Rocket extra jars_*: `http://connectors.<tenant>-<namespace>/v1/api/artifact/sscc-salesforce-0.3_2.12-1.1.x.jar`.

You should be left with a configuration similar to the following image:

image::salesforce-rocket-environment.png[]

==== Managing secrets

Upload the access credentials for the _workflows_ and for _Stratio Rocket_ to _Stratio KMS_ as described in the prerequisites.

[#rocket-configuration]

==== Configuration management: quality rules and lineage

Access the _Stratio Rocket_ configuration in 'Settings' -> 'Governance Lineage' and make sure that the "Governance Lineage" option is enabled.

The fields to be filled in are the following:

* _Custom lineage and quality rules methods using Spark format_: `salesforce:com.stratio.connectors.ssccsalesforce.SalesforceQualityRulesAndLineage:getMetadataPath`.
** This option activates lineage for data flows using _datasource_ boxes that access the data store directly.
+
IMPORTANT: For lineage to work properly, the discovery agent must have the value `<host_url_salesforce>.port.<port_url_salesforce>` as its _Service Name_.

* _Custom planned quality rules methods_: `com.stratio.connectors.ssccsalesforce.SalesforceDriverMD5:com.stratio.connectors.ssccsalesforce.SalesforceQualityRulesAndLineage:getPlannedQRCreateTable`.
** With this option, the planned quality rules that directly access tables in the data store will be supported.

NOTE: Remember that, if you already have more than one artifact in the list, you have to add the following ones, separating them with a comma.

Restart _Stratio Rocket_ to apply the changes.

NOTE: These variables are *not necessary* for lineage and quality rules on virtualized tables in the catalog.

=== _Stratio Intelligence_

To correctly configure _Stratio Intelligence_, see the xref:salesforce:quick-start-guide.adoc#_stratio_intelligence[__Stratio Intelligence__ section]. For integration with Salesforce, only the credentials shown in the prerequisites need to be uploaded.
