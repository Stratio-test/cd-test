= Operations guide

== Description

The SSCC SAS® Grid Manager connector allows you to integrate files generated by SAS® Grid Manager into _Stratio Generative AI Data Fabric_. In the current version, these files must be accessible through the SFTP protocol.

Both the supported features and the different versions are found in the xref:sas-grid-manager:compatibility-matrix.adoc[compatibility matrix].

=== Authentication

Currently, the connector only supports *username and password* authentication via SFTP protocol.

As will be seen later, specific configuration values and credentials will have to be used in each of the _Stratio Generative AI Data Fabric_ services.

== Prerequisites

. Install the xref:connectors-repository:operations-guide.adoc#_installation[connectors repository].
+
Visit the xref:connectors-repository:operations-guide.adoc#_installation[operations guide] section to find out how to install the repository.
+
IMPORTANT: In the connectors repository, the `sscc-sas-0.3_2.12-1.1.x` artifact, which will be used for basic use of the SSCC SAS® Grid Manager connector, will be available at the URL `http://connectors.<tenant>-<namespace>/v1/api/artifact/<artifact_name>`.

. The _Stratio KMS_ UI should be accessible to manage credentials:
+
See the section of xref:ROOT:quick-start-guide.adoc#access-kms-ui[_Stratio KMS_ UI] for the steps you need to take to make it available.

. Have the files accessible to _Stratio Generative AI Data Fabric_ through the SFTP protocol with the authentication mode configured:
+
** For basic authentication you will need one user per service with the appropriate permissions and password.
** You must have a _file system_ server type user for each _Stratio Generative AI Data Fabric_ service. Each user must have the following minimum permissions for the platform service.
+
|===
| Service | Tables | Directories

| _Stratio Data Governance_
| -r--r----- (440)
| dr--r----- (440)

| _Stratio Virtualizer_
| -r--r----- (440)
| dr--r----- (440)

| _Stratio Rocket_
| -r--r----- (440)
| dr--r----- (440)

| _Workflows_ de _Stratio Rocket_
| -r--r----- (440)
| dr--r----- (440)

| _Stratio Intelligence_
| -r--r----- (440)
| dr--r----- (440)
|===

. Create secrets in _Stratio KMS_. To do this, go to `https://<stratio_kms_ui_url>/ui/vault/secrets` and create a different secret in the corresponding folder of the service with the following options:
+
** Username/Password
*** *_user_*: `<sas_user>`.
*** *_pass_*: `<sas_password>`.
+
Each secret must be uploaded to each of the _Stratio KMS_ directories:

** *Discovery agent*: `userland/passwords/<agent_name>.<namespace>/<discovery_secret_name>`.
** *_Stratio Virtualizer_*: `userland/passwords/<virtualizer_namer>.<namespace_virtualizer>/<virtualizer_secret_name>`.
** *_Stratio Rocket_*: `userland/passwords/<rocket_name>.<namespace_rocket>/<rocket_secret_name>`.
** *_Stratio Rocket_ _workflows_*: `userland/passwords/<rocket_workflow_secret_name>`.
** *_Stratio Intelligence_*: `/people/passwords/<intelligence_user_name>/<secret_name>`.
+
NOTE: The name of the secret for all services must match the ones used to configure the discovery agent.
+
--
NOTE: You need to restart the service for changes to this configuration to take effect.
--

== Discover your data

=== Discovery agent

To install a _Stratio Data Governance_ discovery agent for SAS® Grid Manager you must go to '_Stratio Command Center_' -> 'Deploy a Service' -> 'Connectors FS' and select "SAS® Grid Manager Agent".

The fields to be filled in for the installation are:

* *_General_*
** *_Service ID_*: agent's unique identifier. Example: _dg-sasgrid-agent_.
** *_Service name_*: name displayed in _Stratio KEOS_. Example: _dg-sasgrid-agent_.
* *Metadata Datastore (PostgreSQL®)*
** *_Host_*: the PostgreSQL® instance that stores the discovered metadata. Example: _pgbouncer-postgreskeos-governance.keos-core_.
* *Configuration of the Service to be Discovered*
** *Service to be discovered:*
*** *_Service name_*: name that will be used to identify this data store in _Stratio Data Governance_. It's the one that will be displayed in the UI. Example: _dg-sasgrid-agent_.
*** *_Root discovery path_*: identifier of the SAS® Grid Manager resource you want to be discovered. They should be separated by commas, without spaces, and with a slash `/` at the beginning. Example: `/sas/connectorstest,/usr/local/SASHome/SASFoundation/9.4/sashelp`.
+
image::sas-grid-cct-deployment1.png[]
+
** *Resource datastore connection configuration*
*** *_Custom Service URL_*: JDBC URL used to connect to the file system server. Example: `gridconnectors.stratio.com:22`.
*** *_Custom data store service security_*: type of authentication used for the connection: MD5 (username/password).
*** *_Access credentials_*: name of the secret created in xref:#create-secret[_Stratio KMS_]. Example: _sasgrid-secret_.
*** *_SSCC driver location_*: URL where the artifact that will contain the JAR of the SSCC SAS® Grid Manager connector is located in the connectors repository. Example: `http://connectors.<tenant>-<namespace>/v1/api/artifact/sscc-sas-0.3_2.12-1.1.x.jar`.
** *DFS configuration parameters*
*** *_GLOB filter_*: https://en.wikipedia.org/wiki/Glob_(programming)[GLOB pattern] to filter directories. Several patterns separated by `;` can be included.
*** *_Parallelism Level_*: degree of parallelism used in the discovery. By default, it is automatically calculated according to the CPU capacity assigned to the agent.
+
image::sas-grid-cct-deployment2.png[]

The discovery process is asynchronous. Once the discovery is finished you can view it from the _Stratio Data Governance_ UI.

image::sas-grid-discover-metadata.png[]

== Virtualize your data

IMPORTANT: Note that to virtualize the discovered tables, you need to manage the xref:stratio-gosec:operations-manual:data-access/manage-policies/manage-domains-policies.adoc[domain policies] through _Stratio GoSec_.

=== Eureka agent

To use the BDL, you need to configure the Eureka agent with the SSCC SAS® Grid Manager connector. To do this, just add the URL of the connectors repository of the `sscc-sas-0.3_2.12-1.1.x` artifact in the variable 'Customized deployment' -> 'Settings' -> `Additional jars`.

image::sas-viya-bdl.png[]

NOTE: Remember that, if you already have more than one artifact in the list, you have to add the following ones, separating them with a comma.

TIP: See here xref:stratio-data-governance:user-manual:data-processing-with-bdl.adoc[more information about data processing with BDL].

=== _Stratio Virtualizer_

_Stratio Virtualizer_ supports interaction with SAS® Grid Manager through the SSCC SAS® Grid Manager connector. This integration has certain requirements:

* The following _Stratio Virtualizer_ deployment fields must be modified in _Stratio Command Center_.
+
--
** 'Customized deployment' -> 'Environment' -> 'External datastores' -> 'JDBC Integration'.
*** *_JDBC Integration_*: `True`.
** 'Customized deployment' -> 'Environment' -> 'External datastores' -> 'JDBC Drivers URL List'.
*** *_JDBC Drivers URL List_*: `http://connectors.<tenant>-<namespace>/v1/api/artifact/sscc-sas-0.3_2.12-1.1.x.jar`.
--
+
image::sas-viya-virtualizer-conf.png[]

== Transform your data

=== _Stratio Rocket_

To use _Stratio Rocket_, the SSCC SAS® Grid Manager connector must be configured. To do this:

* You have to add the URL of the `sscc-sas-0.3_2.12-1.1.x` artifact in the 'Customized deployment' -> 'Settings' -> 'Classpath configuration' -> `Rocket extra jars` variable of _Stratio Command Center_.
** *_Rocket extra jars_*: `http://connectors.<tenant>-<namespace>/v1/api/artifact/sscc-sas-0.3_2.12-1.1.x.jar`.
+
image::sas-viya-rocket-conf.png[]

* Enter the following variable in the _Stratio Rocket_ configuration: `SPARK_HADOOP_FS_SFTP_IMPL`*: `com.stratio.connectors.sftp.fs.SSCCSFTPFileSystem`.
* You also have to upload the access credentials for _workflows_ and for _Stratio Rocket_ to _Stratio KMS_.

=== _Stratio Intelligence_

Prior to integration with the connector it is necessary to configure _Stratio Intelligence_, as it is described in the xref:ROOT:quick-start-guide#_stratio_intelligence[general quick start guide].

== Managing the driver

To access and exploit SAS® Grid Manager data it is necessary to configure _Stratio Intelligence_ as follows:

* Add the SSCC SAS® Grid Manager connector to the _Stratio Intelligence_ instance:
** Go to '_Stratio Command Center_' -> 'Services' -> '<Your Namespace>' -> 'intelligence' -> 'Edit' -> 'Customize deployment' -> 'Settings' -> 'Analytic Environment Settings' -> 'Extra jars to Spark Context Configuration'.
** Add to the _Spark classpath extra jars_ field the URL of the connector `http://connectors.<tenant>-<namespace>/v1/api/artifact/sscc-sas-0.3_2.12-1.1.x.jar`.
+
image::sas-grid:conf-intelligence.png[]
+
** Add that same URL to the Apache Spark™ classpath.
+
IMPORTANT: Because _Stratio Intelligence_ needs to have the connector available at Apache Spark™ initialization time, the connector needs to be on the classpath when starting the _Notebook_. Currently, the way to do this is to edit the corresponding _Stratio Intelligence_ descriptor in Kubernetes and add the connector URL to the `ANALYTIC_ENV_SPARK_HOME_EXTRA_JARS` environment variable.
+
image::sas-grid:conf-intelligence-env-vars.png[]

==== Managing secrets

Upload the access credentials for the _workflows_ and for _Stratio Rocket_ to _Stratio KMS_ as described in the prerequisites
