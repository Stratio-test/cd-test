= User guide

== Description

The SSCC IBM Db2 connector allows you to completely integrate IBM Db2 into _Stratio Generative AI Data Fabric_.

Both the supported features and the different versions are found in the xref:ibm-db2:compatibility-matrix.adoc[compatibility matrix].

== Discover your data

=== Know your data

_Stratio Generative AI Data Fabric_ can perform discovery tasks on IBM Db2 metadata. The hierarchy supported by the connector is:

. Database
. Schemas
. Tables
. Columns

The IBM Db2 database must be organized according to the above structure to successfully discover the data. You also need to provide the discovery agent with the name of the databases you want it to connect to.

TIP: Have a look at the https://www.ibm.com/docs/en/db2/11.5?topic=database-administration[official IBM Db2 guide] for more information.

The only type of authentication supported is *username/password (MD5)*.

Some of the attributes of the discovery agent are the following:

* _Security_: *MD5*. Username/password authentication. It is unique.
* _driver_: *com.stratio.connectors.ssccdb2.Db2DriverMD5*.
* _databaseName_: name of your database that it discovered.
* _databaseVersion_: version of your database that it discovered.
* _jdbcDriver_: URL of the JDBC driver.
* _jdbcDriverName_: name of the JDBC driver.
* _jdbcDriverVersion_: version of the JDBC driver.

These are the discovery views:

*Database*

image::db2-vista-total-db.png[]

Attributes:

* type: db2

*Schema + table*

image::db2-vista-total-tablas.png[]

Attributes:

* _Primary keys_
* _Foreign keys_
* _Unique keys_
* _database_: name of the database.
* _schema_: name of the schema.
* _table_: name of the table.
* _table type_: it can be "TABLE" or "VIEW".

*Columns*

image::db2-vista-cols-total.png[]

Attributes:

* _type_: type of data conversion to the _Stratio Generative AI Data Fabric_ platform.
* _nullable_: if the field allows nulls.
* _ordinal_: column number.
* _precision + scale_: size of the field.
* _isSigned_: if it is verified.
* _sourceType_: type of the original field in the IBM Db2 database.

You can now create your own technical collections.

IMPORTANT: If you want to add attributes to the tables, you have to do it on the table you added to the technical collection, never on the discovery agent itself.

The data conversion used by _Stratio Generative AI Data Fabric_ for IBM Db2 is as follows:

|===
|IBM Db2 type |Stratio type |IBM Db2 type |Stratio type |IBM Db2 type |Stratio type

|XML
|STRING
|VARCHAR
|STRING
|CHAR
|STRING

|VARGRAPHIC
|STRING
|GRAPHIC
|STRING
|TIME
|TIMESTAMP

|TIMESTAMP
|TIMESTAMP
|INT
|INTEGER
|INTEGER
|INTEGER

|SMALLINT
|INTEGER
|DECIMAL
|DECIMAL
|NUMERIC
|DECIMAL

|DECFLOAT
|DECIMAL(38,18)
|DOUBLE
|DOUBLE
|BLOB
|BINARY

|CLOB
|STRING
|REAL
|FLOAT
|BOOLEAN
|BOOLEAN

|BINARY
|BINARY
|UNKNOWN
|STRING
|LABEL
|STRING
|===

== Virtualize your data

After tables have been discovered, you can add them to a technical view of a collection. All the configurable parameters of the discovery and those parameters modified from the _Stratio Data Governance_ UI are propagated in the collections where that table is added.

TIP: You can read more about its features in its xref:stratio-data-governance:user-manual:collections.adoc[user guide].

IMPORTANT: Note that to virtualize the discovered tables, you need to manage the xref:stratio-gosec:operations-manual:data-access/manage-policies/manage-domains-policies.adoc[domain policies] through _Stratio GoSec_.

If you want to learn more about the virtualization modes, take a look at the xref:stratio-virtualizer:user-guide:what-can-i-do-with-stratio-virtualizer.adoc#_supported_data_sources[_Stratio Virtualizer_ guide].

To set up _Stratio Virtualizer_ so that it can use each type of provider, go to the xref:ibm-db2:operations-guide.adoc[Connection provider settings] in the operations guide.

To virtualize the SSCC IBM Db2 connector, you'll have to add some of its tables in a _Stratio Data Governance_ collection and grant permissions in _Stratio GoSec_. Once you do that, the data will be accessible in the remaining _Stratio Generative AI Datafabric_ modules. You can see how they appear in the following image:

image::db2-coleccion-tecnica.png[BDL]

To create a table directly in the _Stratio Virtualizer_ catalog, you can execute the following statements:

* If you want to create the table with native mode:

[source,sql]
----
CREATE TABLE db2_table USING com.stratio.crossdata.connector.db2 OPTIONS (
    `stratiosecurity` 'true',
    `stratiosecuritymode` 'custom_sscc',
    `stratiocredentials` '<secret_name>',
    `stratiossccdriver` 'com.stratio.connectors.ssccdb2.Db2DriverMD5',
    `driver` 'com.ibm.db2.jcc.DB2Driver',
    `url` 'jdbc:db2://<db2_host>:<db2_port>/<db2_database>',
    `dbtable` '<table_name>'
)
----

* If you want to create the table without native mode:

[source,sql]
----
CREATE TABLE db2_table USING jdbc OPTIONS (
    `stratiosecurity` 'true',
    `stratiosecuritymode` 'custom_sscc',
    `stratiocredentials` '<secret_name>',
    `stratiossccdriver` 'com.stratio.connectors.ssccdb2.Db2DriverMD5',
    `driver` 'com.ibm.db2.jcc.DB2Driver',
    `url` 'jdbc:db2://<db2_host>:<db2_port>/<db2_database>',
    `dbtable` '<table_name>'
)
----

== Transform your data

=== _Stratio Rocket_

In _Stratio Rocket_ you can use any _workflow_ to perform your operations with IBM Db2 data. Use _Crossdata_ or SQL type boxes as input for your _workflows_.

Writing to IBM Db2 is supported. Use a _Crossdata_ box to write directly to the database. You have to point to the table that already exists in a specific collection. _Stratio Rocket_ will write directly to the original IBM Db2 table. When writing, you must capitalize the schema and the table.

The best way to check the data access to IBM Db2 is through *the catalog*. The connector can work with quality rules to perform checks on the data.

In _Stratio Rocket_ the virtualized IBM Db2 collection can be accessed via SQL queries directly or via a _workflow_, an example of both is shown in the following images:

image::db2-vista-catalogo.png[BDL]

image::db2-workflow.png[BDL]

When a _Stratio Rocket_ _workflow_ has been executed, you can visualize its technical lineage by accessing over the table in the technical collection, as shown in the image:

image::db2-linage.png[Linaje,500]

=== _Stratio Intelligence_

You can use a _Crossdata_ session in _Stratio Intelligence_ to quickly access your data using a Jupyter Notebook (use a PySpark session). Below is an example to help you do this.

Always use your attached collection reference with your table.

[source,python]
----
from pystratio.xd.xdsession import XDSession
xd = XDSession(sc)
xd.sql("SELECT * FROM db2_col.YOUR_TABLE LIMIT 3").show()
----

You can see how the data is accessed from _Stratio Intelligence_ in the xref:ROOT:quick-start-guide.adoc#_stratio_intelligence[general quick start guide].
